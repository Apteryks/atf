                     Automated Testing Framework (atf)
                        The NetBSD Foundation, Inc.
---------------------------------------------------------------------------


Introduction
============

This document describes the procedure to create and publish a new ATF
release.  It is provided as a check-list, which must be followed in the
order provided.  If there is any problem in any step, it must be fixed
and the whole process must be restarted from scratch.


How to make a release
=====================

* Run 'make distcheck'.

* Sanity-check the resulting .tar.gz file as described in "How to
  sanity-check a distribution file".

* Run 'make release'.  Store the resulting directory in a safe place.

* Tag the release in the repository, using a tag name that matches the
  distfile's base name.  Typically: atf-<major>.<minor>[.<micro>]

* Publish the release as described in "How to publish a release".


How to sanity-check a distribution file
=======================================

* Unpack the tarball generated in the previous section into a temporary
  directory.

* Ensure the version number is correct.

* Configure and install the program using a temporary prefix.

* Run 'make check' and 'make installcheck'.  You need to set the PATH
  accordingly to find the binaries installed in the temporary prefix chosen
  in the previous point.

* Check that building the release with both NetBSD's bmake and GNU Make
  works.

* Check that building the release outside the source tree (using a build
  directory) works.

* Build a complete release of NetBSD/amd64 current, install it and run all
  the tests in it.  Store the output of this run.

* Import the new release into the NetBSD source tree.

* Rebuild and install the same NetBSD release, *without* updating the
  source tree.  Rerun all the tests in it.  Compare the output with the
  previous run and ensure there are no regressions caused by ATF itself.

* Update the ATF package in pkgsrc to the new release and ensure it builds
  and installs without any patches.  Run all the tests in prefix/tests to
  make sure they work.


How to publish a release
========================

* Upload the distfile, the .cksums file and the .asc file to the FTP
  server.  The current location for releases is:

  ftp://ftp.NetBSD.org/pub/NetBSD/misc/jmmv/atf/<major>.<minor>/

* Announce the new version in the ATF's web page.

* Announce the new version in the ATF's project page at Freshmeat.net.


---------------------------------------------------------------------------
                              End of document
