.\"
.\" Automated Testing Framework (atf)
.\"
.\" Copyright (c) 2008 The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND
.\" CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
.\" INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS BE LIABLE FOR ANY
.\" DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
.\" GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
.\" IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
.\" OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
.\" IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd May 6, 2008
.Dt ATF-C-SANITY 3
.Os
.Sh NAME
.Nm atf_sanity_inv ,
.Nm atf_sanity_pre ,
.Nm atf_sanity_post ,
.Nm INV ,
.Nm PRE ,
.Nm POST
.Nd consistency checks for internal program state
.Sh SYNOPSIS
.In atf-c/sanity.h
.\"
.Ft void
.Fn atf_sanity_inv "const char *" "int" "const char *"
.Ft void
.Fn atf_sanity_pre "const char *" "int" "const char *"
.Ft void
.Fn atf_sanity_post "const char *" "int" "const char *"
.\"
.Ft void
.Fn INV "bool"
.Ft void
.Fn PRE "bool"
.Ft void
.Fn POST "bool"
.\"
.Sh DESCRIPTION
.\"
The
.Nm sanity
module from
.Xr atf-c 3
provides run-time assertion checking with friendly user messages when
assertions fail.
All the code in the library uses the macros provided by this module to
do consistency checks instead of the standard
.Xr assert 3 .
.\"
.Ss Free macros
.Bl -ohang
.It Ft void Fn INV "bool expr"
Performs an invariant check; i.e. a check of a condition that must always
be true at a certain place of the code.
To do this, the macro ensures that the boolean expression
.Fa expr
is true and otherwise calls
.Nm atf_sanity_inv
to report the failure.
.It Ft void Fn PRE "bool expr"
Performs a precondition check; i.e. a check for the validity of the input
parameters and the consistency of the program state at the entry point of
a function.
To do this, the macro ensures that the boolean expression
.Fa expr
is true and otherwise calls
.Nm atf_sanity_pre
to report the failure.
.It Ft void Fn POST "bool expr"
Performs a postcondition check; i.e. a check for the validity of the return
value and the consistency of the program state at the exit point of
a function.
To do this, the macro ensures that the boolean expression
.Fa expr
is true and otherwise calls
.Nm atf_sanity_post
to report the failure.
.El
.\"
.Ss Free functions
.\"
.Bl -ohang
.It Ft void Fn atf_sanity_inv "const char *file" "int line" "const char *msg"
Reports an invariant failure that happened at line
.Fa line
of file
.Fa file
and shows the message
.Fa msg
as the reason for the failure.
Execution of the program is immediately terminated with a
.Dv SIGABRT .
.It Ft void Fn atf_sanity_pre "const char *file" "int line" "const char *msg"
Reports an precondition failure that happened at line
.Fa line
of file
.Fa file
and shows the message
.Fa msg
as the reason for the failure.
Execution of the program is immediately terminated with a
.Dv SIGABRT .
.It Ft void Fn atf_sanity_post "const char *file" "int line" "const char *msg"
Reports an postcondition failure that happened at line
.Fa line
of file
.Fa file
and shows the message
.Fa msg
as the reason for the failure.
Execution of the program is immediately terminated with a
.Dv SIGABRT .
.El
.\"
.Sh SEE ALSO
.\"
.Xr atf-c 3 ,
.Xr atf 7
